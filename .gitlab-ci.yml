---
###############################################################################
# GRAPHQL MODULE PIPELINE
###############################################################################

include:
  - project: 'inuits/gitlab-ci/pipeline-templates'
    file: 'pipelines/applications/graphql-module-pipeline.yml'
    ref: 'v4.10.0'

variables:
  GRAPHQL_IMAGE: 'pza/dams-graphql'
  MOVE_SCHEMA: 'baseSchema.schema.ts'

# ðŸ‘‡ Temporary job for testing
test-job-2:
  stage: test
  tags:
    - prod
  before_script:
    - corepack enable
    - corepack prepare pnpm@7.26.0 --activate
    - pnpm install
  script: |
    echo "DEBUG: Looking for test files..."
    find . -type f \( -name "*.test.ts" -o -name "*.spec.ts" \) -print

    TEST_FILES=$(find . -type f \( -name "*.test.ts" -o -name "*.spec.ts" \))
    if [ -n "$TEST_FILES" ]; then
      echo "Found test files, running vitest..."
      pnpm vitest --run
    else
      echo "No test files found, skipping tests."
    fi